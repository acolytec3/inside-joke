(this.webpackJsonpinsidejoke=this.webpackJsonpinsidejoke||[]).push([[0],{1035:function(e,t){},1037:function(e,t){},1134:function(e,t){},1223:function(e,t){},1269:function(e,t){},1449:function(e,t){},1510:function(e,t){},1526:function(e,t){},1609:function(e,t){},1664:function(e,t,a){},1665:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(100),c=a.n(o),l=(a(731),a(1)),i=a.n(l),s=a(37),u=a(16),p=a(1685),d=a(1684),m=a(1686),f=a(668),h=a(1681),g=a(1687),v=a(1676),y=a(1683),b=a(671),E=a.n(b),w=a(672),k=a.n(w),O=a(25),x=a.n(O),S=a(91),j=a.n(S),C=a(689),P=a(1673),I=a(164),T=a(1688),F=a(1682),A=a(397),R=a.n(A),D=(a(1658),{ipfs:null,username:"",password:"",location:{lat:"",lon:""}}),M=Object(n.createContext)({state:D,dispatch:function(){return null}}),L=function(){var e=r.a.useContext(M),t=r.a.useState(""),a=Object(u.a)(t,2),n=a[0],o=a[1],c=Object(P.a)(),l=c.isOpen,d=c.onOpen,f=c.onClose,h=Object(I.useToast)();function g(e){for(var t=atob(e.split(",")[1]),a=e.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(t.length),r=new Uint8Array(n),o=0;o<t.length;o++)r[o]=t.charCodeAt(o);var c=new DataView(n);return new Blob([c],{type:a})}var y=function(){var e=Object(s.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o(t),f();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),b=function(){var t=Object(s.a)(i.a.mark((function t(a,r){var c,l,s;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,c=g(n),!e.state.ipfs){t.next=14;break}return t.next=5,e.state.ipfs.add(c,{progress:function(e){return console.log("received: ".concat(e))}});case 5:return l=t.sent,console.log(l),t.next=9,e.state.orbit.add({hash:l.path,username:e.state.username,lat:a,lon:r});case 9:s=t.sent,console.log("Lets verify the hash"),console.log(e.state.orbit.get(s)),h({position:"top",status:"success",title:"Media uploaded",description:"You should see your media in the Gallery shortly",duration:5e3}),o("");case 14:t.next=20;break;case 16:t.prev=16,t.t0=t.catch(0),console.error(t.t0),h({position:"top",status:"error",title:"Something went wrong",description:"Please try again",duration:5e3});case 20:case"end":return t.stop()}}),t,null,[[0,16]])})));return function(e,a){return t.apply(this,arguments)}}();return r.a.createElement(p.a,{align:"center"},""===n?r.a.createElement(m.a,{alignSelf:"center",width:"200px",onClick:d,isDisabled:!navigator.mediaDevices},"Take Picture"):r.a.createElement(p.a,{maxWidth:"100vh",align:"center"},r.a.createElement(T.a,{maxWidth:"100px",src:n}),e.state.location&&""!==e.state.location.lat&&r.a.createElement(v.a,{color:"white"},"Latitude: ",e.state.location.lat,", Longitude: ",e.state.location.lon),r.a.createElement(m.a,{alignSelf:"center",width:"200px",onClick:function(){var t,a;e.state.location?(t=e.state.location.lat,a=e.state.location.lon):(t="",a=""),b(t,a)}},"Upload Picture")),!navigator.mediaDevices&&r.a.createElement(v.a,{color:"white"},"The camera is unavailable in this browser"),r.a.createElement(F.a,{isOpen:l,onClose:f,isCentered:!0,size:"100%"},r.a.createElement(F.f,null),r.a.createElement(F.d,null,r.a.createElement(F.b,null,r.a.createElement(R.a,{onTakePhoto:function(e){y(e)},onCameraError:function(e){alert(e.toString())},idealFacingMode:A.FACING_MODES.ENVIRONMENT,isImageMirror:!1})))))},B=a(1678),G=function(){var e=r.a.useContext(M),t=r.a.useRef(null),a=r.a.useState(e.state.location.lat),n=Object(u.a)(a,2),o=n[0],c=n[1],l=r.a.useState(e.state.location.lon),f=Object(u.a)(l,2),h=f[0],g=f[1],v=r.a.useState(void 0),y=Object(u.a)(v,2),b=y[0],E=y[1],w=Object(I.useToast)(),k=function(){var e=Object(s.a)(i.a.mark((function e(t){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(a=t.target.files)&&a.length>0&&E(a[0]);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),O=function(){var t=Object(s.a)(i.a.mark((function t(){var a,n,r,c,l;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,a=b,n=""!==o?o:e.state.location.lat,r=""!==h?h:e.state.location.lon,!e.state.ipfs){t.next=15;break}return t.next=7,e.state.ipfs.add(a,{progress:function(e){return console.log("received: ".concat(e))}});case 7:return c=t.sent,console.log(c),t.next=11,e.state.orbit.add({hash:c.path,username:e.state.username,lat:n,lon:r});case 11:l=t.sent,console.log("Lets verify the hash"),console.log(e.state.orbit.get(l)),w({position:"top",status:"success",title:"Media uploaded",description:"You should see your media in the Gallery shortly",duration:5e3});case 15:t.next=21;break;case 17:t.prev=17,t.t0=t.catch(0),console.error(t.t0),w({position:"top",status:"error",title:"Something went wrong",description:"Please try again",duration:5e3});case 21:E(void 0);case 22:case"end":return t.stop()}}),t,null,[[0,17]])})));return function(){return t.apply(this,arguments)}}();return r.a.createElement(B.a,null,r.a.createElement(p.a,{align:"center"},r.a.createElement(p.a,{isInline:!0},r.a.createElement(m.a,{w:"200px",onClick:function(){t.current&&t.current.click()}},"Select Media"),r.a.createElement(m.a,{w:"200px",isDisabled:!b,onClick:O},"Upload Media")),r.a.createElement("input",{ref:t,type:"file",id:"filePicker",name:"filePicker",style:{display:"none"},onChange:k}),r.a.createElement(p.a,null,r.a.createElement(d.a,{placeholder:"Latitude",defaultValue:e.state.location.lat,onChange:function(e){return c(e.target.value)}}),r.a.createElement(d.a,{placeholder:"Longitude",defaultValue:e.state.location.lon,onChange:function(e){return g(e.target.value)}}))))},N=(a(1664),a(1692)),K=a(1680),_=a(1689),U=a(1679),V=a(1690),z=a(1691),Y=function(){var e=r.a.useContext(M),t=r.a.useState(!1),a=Object(u.a)(t,2),n=a[0],o=a[1],c=Object(P.a)(),l=c.isOpen,i=c.onOpen,s=c.onClose,d=r.a.useState(null),f=Object(u.a)(d,2),h=f[0],g=f[1],y=r.a.useState([parseFloat(e.state.location.lat),parseFloat(e.state.location.lon)]),b=Object(u.a)(y,2),E=b[0],w=(b[1],function(){var t=e.state.orbit.iterator({limit:-1}).collect().filter((function(e){return void 0!==e.payload.value.lat}));return r.a.createElement(_.a,{center:E,zoom:12,style:{height:"60vh"}},t.map((function(e){return r.a.createElement(U.a,{key:e.hash,position:[e.payload.value.lat,e.payload.value.lon],onClick:function(){return g(e)}})})),r.a.createElement(V.a,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),h&&r.a.createElement(z.a,{position:[h.payload.value.lat,h.payload.value.lon],onClose:function(){return g(null)}},r.a.createElement(p.a,{key:h.clock.toString(),isInline:!0},r.a.createElement(T.a,{key:h.hash,width:"100px",objectFit:"cover",src:"https://gateway.ipfs.io/ipfs/".concat(h.payload.value.hash),alt:"Unknown"}),h.payload.value.username&&r.a.createElement(v.a,{color:"white",key:h.hash+"1"},"Posted by ",h.payload.value.username))))}),k=function(){var t=e.state.orbit.iterator({limit:-1}).collect();return r.a.createElement(N.a,{minChildWidth:"100px",spacingX:"20px",spacingY:"10px"},t.map((function(e){return r.a.createElement(p.a,{isInline:!0,key:e.clock.toString(),spacing:1},r.a.createElement(T.a,{key:e.hash,width:"100px",objectFit:"cover",src:"https://gateway.ipfs.io/ipfs/".concat(e.payload.value.hash),alt:"Unknown"}),e.payload.value.username&&r.a.createElement(v.a,{color:"white",key:e.hash+"1"},"Posted by ",e.payload.value.username))})))};return r.a.createElement(B.a,null,r.a.createElement(K.a,{align:"center",direction:"column"},r.a.createElement(p.a,{isInline:!0},r.a.createElement(m.a,{mw:"50vw",onClick:function(){o(!n)}},"View Posted Media"),r.a.createElement(m.a,{w:"200px",onClick:i},"Open Map")),n&&r.a.createElement(k,null),r.a.createElement(F.a,{isOpen:l,onClose:s,isCentered:!0,size:"100%"},r.a.createElement(F.f,null),r.a.createElement(F.e,null,"Reported Activity"),r.a.createElement(F.c,null),r.a.createElement(F.d,null,r.a.createElement(F.b,null,r.a.createElement(w,null))))))},W=a(17),J=function(e,t){switch("LOGIN"!==t.type&&console.log(e),"LOGIN"!==t.type&&console.log(t),t.type){case"START_IPFS":return Object(W.a)(Object(W.a)({},e),{},{ipfs:t.payload.ipfs});case"LOGIN":return Object(W.a)(Object(W.a)({},e),{},{username:t.payload.username,password:t.payload.password,keyPair:t.payload.keyPair});case"SET_KEYPAIR":return Object(W.a)(Object(W.a)({},e),{},{keyPair:t.payload.keyPair,username:"",password:""});case"START_ORBIT":return Object(W.a)(Object(W.a)({},e),{},{orbit:t.payload.orbit});case"SET_LOCATION":return Object(W.a)(Object(W.a)({},e),{},{location:t.payload.location});default:return e}};window.LOG="orbit*";var q=function(){var e=r.a.useReducer(J,D),t=Object(u.a)(e,2),a=t[0],n=t[1],o=r.a.useState(!1),c=Object(u.a)(o,2),l=c[0],b=c[1],w=r.a.useState(!1),O=Object(u.a)(w,2),S=O[0],P=O[1],I=r.a.useState(""),T=Object(u.a)(I,2),F=T[0],A=T[1],R=function(){var e=Object(s.a)(i.a.mark((function e(){var t,r,o,c,l,s,u,p;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b(!0),navigator.geolocation&&navigator.geolocation.getCurrentPosition((function(e){n({type:"SET_LOCATION",payload:{location:{lat:e.coords.latitude,lon:e.coords.longitude}}})})),e.prev=2,A("Deriving Keys"),"ihatemakinguplongpasswords",t=(new TextEncoder).encode(a.username+a.password+"ihatemakinguplongpasswords"),e.next=8,Object(C.a)(t,"rsa",{privateKeyFormat:"raw-pem",publicKeyFormat:"raw-pem"});case 8:return r=e.sent,n({type:"SET_KEYPAIR",payload:{keyPair:r}}),A("Connecting to IPFS"),e.next=13,j.a.keys.import(r.privateKey,"");case 13:return o=e.sent,e.next=16,x.a.createFromPrivKey(j.a.keys.marshalPrivateKey(o,"rsa"));case 16:return c=e.sent,e.next=19,E.a.create({libp2p:{PeerId:c},relay:{enabled:!0,hop:{enabled:!0,active:!0}},repo:"ipfs-inside-joke",config:{Addresses:{Swarm:["/dns4/wrtc-star1.par.dwebops.pub/tcp/443/wss/p2p-webrtc-star/","/dns4/wrtc-star2.sjc.dwebops.pub/tcp/443/wss/p2p-webrtc-star/"]},pubsub:{}}});case 19:return(l=e.sent).libp2p.on("peer:connect",(function(e){return console.log("connected to ".concat(e.remotePeer.toB58String()))})),console.log("IPFS Started"),A("Connecting to Orbit-DB"),e.next=25,k.a.createInstance(l);case 25:return s=e.sent,e.next=28,s.determineAddress("monkey-knuckles","eventlog",{accessController:{write:["*"]}});case 28:if(u=e.sent,console.log("address is",u),!u){e.next=37;break}return e.next=33,s.open(u);case 33:p=e.sent,console.log("found Db!",p),e.next=40;break;case 37:return e.next=39,s.eventlog("monkey-knuckles",{});case 39:p=e.sent;case 40:return e.next=42,p.load();case 42:p.events.on("replicate",(function(e){return console.log("Replicating DB to ",e)})),p.events.on("peer",(function(e){return console.log("Found a peer with our DB",e)})),p.events.on("replicate.progress",(function(e){return console.log(e)})),p.events.on("replicated",(function(e){return console.log("Replicating DB from",e)})),console.log("Orbit DB initiated"),n({type:"START_IPFS",payload:{ipfs:l}}),n({type:"START_ORBIT",payload:{orbit:p}}),b(!1),P(!0),setTimeout((function(){l.swarm.connect("/ip4/172.31.1.4/tcp/4003/ws/p2p/QmaSDYtcdw1fuK4DGVSF2zK1QxNTUwM9GVM458AG9SFekE"),console.log("dialing")}),3e3),e.next=58;break;case 54:e.prev=54,e.t0=e.catch(2),console.error("IPFS init error:",e.t0),b(!1);case 58:case"end":return e.stop()}}),e,null,[[2,54]])})));return function(){return e.apply(this,arguments)}}(),B=function(){var e=r.a.useState(""),t=Object(u.a)(e,2),a=t[0],o=t[1],c=r.a.useState(""),l=Object(u.a)(c,2),i=l[0],s=l[1];return r.a.createElement(p.a,{align:"center"},r.a.createElement(d.a,{w:"200px",isRequired:!0,placeholder:"Username",value:a,onChange:function(e){return o(e.target.value)}}),r.a.createElement(d.a,{w:"200px",isRequired:!0,placeholder:"Password",type:"password",value:i,onChange:function(e){return s(e.target.value)}}),r.a.createElement(m.a,{w:"150px",onClick:function(){n({type:"LOGIN",payload:{username:a,password:i}}),R()}},"Login"))};return r.a.createElement(f.a,null,r.a.createElement(M.Provider,{value:{dispatch:n,state:a}},r.a.createElement(p.a,{align:"center",w:"100%"},r.a.createElement(h.a,null,"Inside Joke"),r.a.createElement(p.a,{align:"center"}),!a.keyPair&&""===a.username&&r.a.createElement(B,null),l&&r.a.createElement(p.a,{align:"center"},r.a.createElement(g.a,null),r.a.createElement(v.a,null,F)),S&&r.a.createElement(y.e,{isFitted:!0,align:"center",size:"lg"},r.a.createElement(y.d,null,r.a.createElement(y.c,null,r.a.createElement(L,null)),r.a.createElement(y.c,null,r.a.createElement(G,null)),r.a.createElement(y.c,null,r.a.createElement(Y,null))),r.a.createElement(y.b,{position:"fixed",bottom:"0px",left:"0px",w:"100vw"},r.a.createElement(y.a,null,"Camera"),r.a.createElement(y.a,null,"Media"),r.a.createElement(y.a,null,"Gallery"))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(q,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},281:function(e,t){},339:function(e,t){},371:function(e,t){},650:function(e,t){},654:function(e,t){},726:function(e,t,a){e.exports=a(1665)},731:function(e,t,a){},738:function(e,t){},746:function(e,t){},815:function(e,t){},816:function(e,t){},911:function(e,t){},913:function(e,t){},973:function(e,t){}},[[726,1,2]]]);
//# sourceMappingURL=main.7c2e3689.chunk.js.map